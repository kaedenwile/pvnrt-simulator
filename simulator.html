<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PVNRT</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
<div id="everything">
    <div id="everythingStretchyWrapper">
        <div id="header">
            <div id="title">PVNRT</div>
            <div id="download"><img id="downloadImage" src="img/download.png" alt=""/>Download simulator data</div>
        </div>
        <div id="mainContent">
            <div id="leftContainer">
                <div id="particleBoxContainer">
                    <div id="particleBoxHeader">
                        <div id="particleBoxSizeSelect">
                            <div id="staticSizeButton" class="strongText particleBoxSizeButton" onclick="setBoxStatic(true)">STATIC</div>
                            <div id="elasticSizeButton" class="weakText particleBoxSizeButton" onclick="setBoxStatic(false)">ELASTIC</div>
                        </div>
                        <div id="particleBoxPressureNumeric">
                            <div id="weakPressureNumber" class="weakText">14.804 atm</div>
                            <div id="strongPressureNumber" class="strongText">1500 Pa</div>
                        </div>
                    </div>
                    <canvas id="particleBox"></canvas>
                    <img id="originalParticleImg" class="hidden" src="img/particle.png"/>
                    <img id="particleImg" class="hidden" src="img/particle.png"/>
                </div>
                <div id="controlsContainer">
                    <div id="temperatureControl" class="control">
                        <div class="controlMax">1000 K</div>
                        <div class="controlSliderBox">
                            <div class="controlBar temperature"></div>
                            <div id="tempSlider" class="controlSlider" style="left: 40%;" onmousedown="beginDragging(event, updateTemperature)"></div>
                        </div>
                        <div class="controlNumeric">
                            <div id="weakTemperatureNumber" class="weakText">-39 C</div>
                            <div id="strongTemperatureNumber" class="strongText">234 K</div>
                        </div>
                    </div>
                    <div id="volumeControl" class="control">
                        <div id="volumeMax" class="controlMax">20 m<sup>3</sup></div>
                        <div class="controlSliderBox">
                            <div class="controlBar volume"></div>
                            <div id="volumeSlider" class="controlSlider" style="left: 20%;" onmousedown="beginDragging(event, updateVolume)"></div>
                        </div>
                        <div class="controlNumeric">
                            <div id="weakVolumeNumber" class="weakText">17.69 ft<sup>3</sup></div>
                            <div id="strongVolumeNumber" class="strongText">8 m<sup>3</sup></div>
                        </div>
                    </div>
                    <div id="moleControl" class="control">
                        <div class="controlMax">30 mol</div>
                        <div class="controlSliderBox">
                            <div class="controlBar moles"></div>
                            <div id="moleSlider" class="controlSlider" style="left: 60%;" onmousedown="beginDragging(event, updateMoles)"></div>
                        </div>
                        <div class="controlNumeric">
                            <div id="moleNumber" class="strongText">4 mol</div>
                        </div>
                    </div>
                    <div id="particleColor" class="control">
                        <div id="particleColorButtonsContainer">
                            <div class="particleColorButton white" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton green" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton yellow" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div id="initialParticleColor" class="particleColorButton orange selected" onclick="selectColor(event);">
                                <div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton red" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton salmon" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton pink" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton purple" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton blue" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                            <div class="particleColorButton sky" onclick="selectColor(event);"><div class="particleColorButtonCore"></div></div>
                        </div>
                        <div class="weakText">Particle Color</div>
                    </div>
                </div>
            </div>
            <div id="rightContainer">
                <div id="rightContainerWrapper">
                    <div id="PVDiagram" class="graph">
                        <div id="PVNumber" class="graphNumber">361 K</div>
                        <div class="graphReset" onclick="resetGraph('PV')">reset</div>
                        <div class="graphTitle">Pressure vs. Volume</div>
                        <div class="graphContent">
                            <img class="graphBG" src="img/chartBG.png"/>
                            <div class="graphFGWrapper">
                                <svg id="PVDiagramSVG" class="graphFG" width="240" height="133" viewBox="0 0 240 133" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
                                    <!-- Points -->
                                    <circle id="PVPoint" cx="120" cy="67" r="4" fill="red"></circle>
                                </svg>
                            </div>
                        </div>
                        <div class="graphXAxisLabelContainer">
                            <div class="graphXAxisLabel">10</div>
                            <div class="graphXAxisLabel">20</div>
                            <div class="graphXAxisLabel">30</div>
                            <div class="graphXAxisLabel">40</div>
                            <div class="graphXAxisLabel">50</div>
                            <div class="graphXAxisLabel">60</div>
                            <div class="graphXAxisLabel">70</div>
                            <div class="graphXAxisLabel">80</div>
                            <div class="graphXAxisLabel">90</div>
                            <div class="graphXAxisLabel">100</div>
                        </div>
                        <div class="graphXAxisTitle">10<sup>6</sup> Pa</div>
                        <div class="graphYAxisLabelContainer">
                            <div class="graphYAxisLabel">2</div>
                            <div class="graphYAxisLabel">4</div>
                            <div class="graphYAxisLabel">6</div>
                            <div class="graphYAxisLabel">8</div>
                            <div class="graphYAxisLabel">10</div>
                            <div class="graphYAxisLabel">12</div>
                            <div class="graphYAxisLabel">14</div>
                            <div class="graphYAxisLabel">16</div>
                            <div class="graphYAxisLabel">18</div>
                            <div class="graphYAxisLabel">20</div>
                        </div>
                        <div class="graphYAxisTitle">m<sup>3</sup></div>
                    </div>
                    <div id="workGraph" class="graph">
                        <div id="workNumber" class="graphNumber">0 kJ</div>
                        <div class="graphReset" onclick="resetGraph('U')">reset</div>
                        <div class="graphTitle">Work Done by Gas</div>
                        <div class="graphContent">
                            <div id="workAxis"></div>
                            <div id="workBarContainer">
                                <div id="ieBar" class="workBar salmon" style="height: 6.65vw; margin-top: 6.65vw;"></div>
                                <div id="qBar"  class="workBar sky" style="height: 6.65vw;"></div>
                                <div id="wBar"  class="workBar orange" style="height: 3vw; margin-top: 6.65vw;"></div>
                            </div>
                            <div id="workBarLabelsContainer">
                                <div id="ieLabel" class="workBarLabel">(Î”U)<br/>Internal Energy</div>
                                <div id="qLabel" class="workBarLabel">(Q)<br/>Heat</div>
                                <div id="wLabel" class="workBarLabel">(W)<br/>Work</div>
                            </div>
                        </div>
                        <div class="graphXAxisLabelContainer">
                            <div class="graphXAxisLabel">-10</div>
                            <div class="graphXAxisLabel">-8</div>
                            <div class="graphXAxisLabel">-6</div>
                            <div class="graphXAxisLabel">-4</div>
                            <div class="graphXAxisLabel">-2</div>
                            <div class="graphXAxisLabel">0</div>
                            <div class="graphXAxisLabel">2</div>
                            <div class="graphXAxisLabel">4</div>
                            <div class="graphXAxisLabel">6</div>
                            <div class="graphXAxisLabel">8</div>
                            <div class="graphXAxisLabel">10</div>
                        </div>
                        <div class="graphXAxisTitle">10<sup>3</sup> J</div>
                    </div>
                    <div id="numericOutput">
                        <table>
                            <tr><td>Pressure</td><td><span id="pressureOutput" class="outputNumber">1500</span>kPa</td></tr>
                            <tr><td>Volume</td><td><span id="volumeOutput" class="outputNumber">8</span>m<sup>3</sup></td></tr>
                            <tr><td>Number of Molecules</td><td><span id="moleOutput" class="outputNumber">4</span>moles</td></tr>
                            <tr><td>Temperature</td><td><span id="tempOutput" class="outputNumber">234</span>K</td></tr>
                            <tr><td>Average Particle Velocity</td><td><span id="velOutput" class="outputNumber">742</span>nm/s</td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div id="footer">
            <a class="footerButton activeButton">Simulator</a>
            <a class="footerButton" href="howto.html">How to Use</a>
            <a class="footerButton" href="faq.html">FAQ</a>
            <a class="footerButton" href="contact.html">Contact</a>
            <a class="footerButton" href="http://corkboardhub.com">Get Corkboard</a>
            <a class="footerButton" href="http://kilometercreative.com">Built by Kilometer Creative LLC</a>
        </div>
    </div>
</div>
<script>
    var currentStates = {
        P: 1500, // pressure of gas
        V: 8, // volume of gas
        n: 4, // moles of gas
        T: 360.8, // temperature of gas
        R: 8.3144598, // ideal gas constant
        m: 32 // mass of particle in amu
    };
    var energyLevels = {
        P: 1500,
        V: 8,
        n: 4,
        T: 360.8
    };

    var currentColorButton = document.getElementById("initialParticleColor");

    var slider;
    var pageDimensions = {
        left: 0,
        sliderWidth: 0,
        boxWidth: 0,
        canvasWidth: 0,
        canvasHeight: 0
    };
    var updateFunction;
    var staticBox = true;
    measureWidths();

    window.addEventListener("resize", resize);
    window.addEventListener("scroll", resize);
    window.addEventListener("mousemove", dragSlider);
    window.addEventListener("mouseup", endDragging);

    var tSliders = document.getElementsByClassName("controlSlider");
    var tSliderFunctions = [updateTemperature, updateVolume, updateMoles];
    for (var i = 0; i < tSliders.length; i++) {
        var tSlider = tSliders[i];
        const func = tSliderFunctions[i];
        tSlider.addEventListener("touchstart", function() {beginDragging(event, func); });
        tSlider.addEventListener("touchmove", dragSlider);
        tSlider.addEventListener("touchend", endDragging);
    }

    function resize() {
        console.log("RESIZE");
        measureWidths();
        updatedCurrentStates();
    }

    function beginDragging(event, func) {
        event.preventDefault();
        slider = event.target;
        updateFunction = func;
    }

    function dragSlider(event) {
        if (slider != null) {
            event.preventDefault();
            unfocus();

//            console.log(touch, event);
//            slider.style.backgroundColor = "#ffff00";

            var percentage = limit(((event.touches ? event.touches[0].clientX : event.clientX) - pageDimensions.left) / pageDimensions.boxWidth);
            placeSlider(slider, percentage);
            updateFunction(percentage);
        }
    }

    function endDragging() {
        event.preventDefault();
        slider = null;
        unfocus();
    }

    function setBoxStatic(isStatic) {
        if (isStatic == staticBox) return;

        var staticButton = document.getElementById("staticSizeButton");
        var elasticButton = document.getElementById("elasticSizeButton");
        if (isStatic) {
            staticBox = true;

            staticButton.classList.remove("weakText");
            staticButton.classList.add("strongText");
            elasticButton.classList.remove("strongText");
            elasticButton.classList.add("weakText");
            document.getElementById("volumeMax").innerHTML = "20 m<sup>3</sup>";

            updateVolume(7/19);
            document.getElementById("weakVolumeNumber").innerHTML = "";
            document.getElementById("strongVolumeNumber").innerHTML = "Volume";
            document.getElementById("volumeSlider").onmousedown = function() { beginDragging(event, updateVolume); };
            setTimeout(function() { updatedCurrentStates(); }, 2000);
        } else {
            staticBox = false;

            elasticButton.classList.remove("weakText");
            elasticButton.classList.add("strongText");
            staticButton.classList.remove("strongText");
            staticButton.classList.add("weakText");
            document.getElementById("volumeMax").innerHTML = "100000 kPa";

            updatePressure(.5);
            document.getElementById("weakVolumeNumber").innerHTML = "";
            document.getElementById("strongVolumeNumber").innerHTML = "Exterior Pressure";
            document.getElementById("volumeSlider").onmousedown = function() { beginDragging(event, updatePressure); };
            setTimeout(function() { updatedCurrentStates(); }, 2000);
        }
    }

    function resetGraph(graph) {
        if (graph == 'PV') {
            document.getElementById('PVDiagramSVG').innerHTML = "<circle id='PVPoint' cx='120' cy='67' r='4' fill='red'></circle>";
            updatedCurrentStates();
        } else if (graph == 'U') {
            captureCurrentState();
            updatedCurrentStates();
        }
    }

    function unfocus() {
        if (document.selection) {
            document.selection.empty()
        } else {
            window.getSelection().removeAllRanges()
        }
    }

    function measureWidths() {
        var slider = document.getElementById("tempSlider");
        pageDimensions.left = window.innerWidth * 0.22;
        pageDimensions.sliderWidth = parseFloat(getComputedStyle(slider).width);
        pageDimensions.boxWidth = parseFloat(getComputedStyle(slider.parentNode).width);
        var pbox = document.getElementById("particleBox");
        pageDimensions.canvasWidth = parseFloat(getComputedStyle(pbox).width);
        pageDimensions.canvasHeight = parseFloat(getComputedStyle(pbox).height);
    }

    function placeSlider(slider, percentage) {
        slider.style.left = percentage*pageDimensions.boxWidth - pageDimensions.sliderWidth / 2  + 'px';
    }

    function colorsFromHex(hex) {
        return {
            r: parseInt(hex.substr(1, 2), 16) / 256,
            g: parseInt(hex.substr(3, 2), 16) / 256,
            b: parseInt(hex.substr(5, 2), 16) / 256
        }
    }

    function colorsToHex(colors) {
        return "#"+('00'+Math.round(colors.r*256).toString(16)).slice(-2) +
                   ('00'+Math.round(colors.g*256).toString(16)).slice(-2) +
                   ('00'+Math.round(colors.b*256).toString(16)).slice(-2);
    }

    function doSliderColor(slider, c1, c2, percentage) {
        var rgb1 = colorsFromHex(c1);
        var rgb2 = colorsFromHex(c2);

        slider.style.backgroundColor = colorsToHex({
            r: rgb1.r + (rgb2.r-rgb1.r)*percentage,
            g: rgb1.g + (rgb2.g-rgb1.g)*percentage,
            b: rgb1.b + (rgb2.b-rgb1.b)*percentage
        });
    }

    function limit(percentage) {
        if (percentage < 0) {
            percentage = 0;
        } else if (percentage > 1) {
            percentage = 1;
        }
        return percentage;
    }

    function selectColor(event) {
        currentColorButton.classList.remove("selected");
        currentColorButton = event.target;
        currentColorButton.classList.add("selected");

        var colorString = getComputedStyle(currentColorButton).backgroundColor.toString();
        var colorParts = colorString.substr(4, colorString.length - 5).split(",");
        var color = {r: parseInt(colorParts[0]), g: parseInt(colorParts[1]), b: parseInt(colorParts[2])};
        colorizeParticle(color);
    }
    selectColor({target: document.getElementsByClassName("selected")[0]});

    function colorizeParticle(color) {
        // Thanks to: http://stackoverflow.com/questions/1445862/possible-to-use-html-images-like-canvas-with-getimagedata-putimagedata
        var particleImageElement = document.getElementById("particleImg");

        var myImgElement = document.getElementById('originalParticleImg');
        var w = myImgElement.width, h=myImgElement.height;

        var canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;
        var ctx = canvas.getContext("2d");

        // 2) Copy your image data into the canvas
        ctx.drawImage( myImgElement, 0, 0 );

        // 3) Read your image data
        var imgdata = ctx.getImageData(0,0,w,h);
        var rgba = imgdata.data;

        // 4) Read or manipulate the rgba as you wish
        for (var px=0,ct=w*h*4;px<ct;px+=4){
            rgba[px  ] = color.r;
            rgba[px+1] = color.g;
            rgba[px+2] = color.b;
        }

        // 5) Update the context with newly-modified data
        ctx.putImageData(imgdata,0,0);

        // 6) Draw the image data elsewhere, if you wish
        particleImageElement.src = canvas.toDataURL("image/png");
    }

    function captureCurrentState() {
        energyLevels.P = currentStates.P;
        energyLevels.V = currentStates.V;
        energyLevels.T = currentStates.T;
        energyLevels.n = currentStates.n;
    }

    function updateTemperature(value) {
        currentStates.T = 1+999*value;
        if (staticBox) {
            updatePressure()
        } else {
            updateVolume()
        }

        updatedCurrentStates();
    }

    function updateVolume(value) {
        if (staticBox) {
            currentStates.V = 1+19*value;
            updatePressure();

            updatedCurrentStates();
        } else {
            currentStates.V = currentStates.n * currentStates.R * currentStates.T / currentStates.P;
            if (currentStates.n === 0 || currentStates.T === 0) {
                currentStates.V = 0;
            } else if (currentStates.P === 0) {
                currentStates.V = Infinity;
            }
        }
    }

    function updateMoles(value) {
        currentStates.n = 30*value;
        editGasAmount();
        if (staticBox) {
            updatePressure()
        } else {
            updateVolume()
        }

        updatedCurrentStates();
    }

    function updatePressure(value) {
        if (staticBox) {
            currentStates.P = currentStates.n * currentStates.R * currentStates.T / currentStates.V;
            if (currentStates.n === 0 || currentStates.T === 0) {
                currentStates.P = 0;
            } else if (currentStates.V === 0) {
                currentStates.P = Infinity;
            }
        } else {
            currentStates.P = 500+99500*value;
            updateVolume();

            updatedCurrentStates();
        }
    }

    function updatedCurrentStates() {
        document.getElementById("strongTemperatureNumber").innerHTML = (currentStates.T).toFixed() +" K";
        document.getElementById("weakTemperatureNumber").innerHTML = (currentStates.T-273).toFixed() +" C";
        placeSlider(document.getElementById("tempSlider"), limit((currentStates.T - 1)/ 999));
        doSliderColor(document.getElementById("tempSlider"), "#37a0fc", "#a9050e", limit((currentStates.T - 1) / 999));

        if (staticBox) {
            document.getElementById("strongVolumeNumber").innerHTML = (currentStates.V).toFixed() +" m<sup>3</sup>";
            document.getElementById("weakVolumeNumber").innerHTML = (currentStates.V * 35.3147).toFixed(3) +" ft<sup>3</sup>";
            placeSlider(document.getElementById("volumeSlider"), limit((currentStates.V - 1) / 19));
            doSliderColor(document.getElementById("volumeSlider"), "#0e699b", "#091a6b", limit((currentStates.V - 1)/ 19));

            document.getElementById("strongPressureNumber").innerHTML = (currentStates.P).toFixed() + " kPa";
            document.getElementById("weakPressureNumber").innerHTML = (currentStates.P / 101325).toFixed(3) + " atm";
        } else {
            document.getElementById("strongVolumeNumber").innerHTML = (currentStates.P).toFixed() +" kPa";
            document.getElementById("weakVolumeNumber").innerHTML = (currentStates.P / 101325).toFixed(3) +" atm";
            placeSlider(document.getElementById("volumeSlider"), limit((currentStates.P - 500) / 99500));
            doSliderColor(document.getElementById("volumeSlider"), "#0e699b", "#091a6b", limit((currentStates.P - 500) / 99500));

            document.getElementById("strongPressureNumber").innerHTML = (currentStates.V).toFixed() +" m<sup>3</sup>";
            document.getElementById("weakPressureNumber").innerHTML = (currentStates.V * 35.3147).toFixed(3) +" ft<sup>3</sup>";
        }

        document.getElementById("moleNumber").innerHTML = (currentStates.n).toFixed(1) +" mol";
        placeSlider(document.getElementById("moleSlider"), limit(currentStates.n / 30));
        doSliderColor(document.getElementById("moleSlider"), "#d59339", "#fc551f", limit(currentStates.n / 30));

        document.getElementById("pressureOutput").innerHTML = (currentStates.P).toFixed();
        document.getElementById("volumeOutput").innerHTML = (currentStates.V).toFixed();
        document.getElementById("moleOutput").innerHTML = (currentStates.n).toFixed(1);
        document.getElementById("tempOutput").innerHTML = (currentStates.T).toFixed();
        document.getElementById("velOutput").innerHTML = (Math.sqrt(currentStates.T * 3 * 1.38064853E-23 / (currentStates.m * 1E-10) *
            1E9 /* nm */)).toFixed(2);

        document.getElementById("PVNumber").innerHTML = (currentStates.T).toFixed() + " K";

        // Chart
        var circle = document.getElementById("PVPoint");
        var cx = (currentStates.V / 22) * 240, cy = currentStates.P > 1E7 ? -5 : (1 - currentStates.P / 105000) * 133, color = document.getElementById("tempSlider").style.backgroundColor;
        circle.setAttribute("cx", cx );
        circle.setAttribute("cy", cy );
        circle.setAttribute("fill", color);

        var PVDiagram = document.getElementById("PVDiagramSVG");
        PVDiagram.innerHTML += "<circle cx='"+cx+"' cy='"+cy+"' r='1' fill='"+color+"'></circle>";


        var workScale = 22000.0;
        var qBar = document.getElementById("qBar"), wBar = document.getElementById("wBar"), uBar = document.getElementById("ieBar");
        var dQ = (currentStates.T - energyLevels.T)*(currentStates.n)*(staticBox ? 3/2 : 5/2);
        var qHeight = limit(Math.abs(dQ) / workScale)*6.65;
        qBar.style.height = qHeight+'vw';
        qBar.style.marginTop = (dQ > 0 ? 6.65 - qHeight : 6.65)+'vw';

        var dW = (currentStates.V - energyLevels.V)*(currentStates.P);
        var wHeight = limit(Math.abs(dW) / workScale)*6.65;
        wBar.style.height = wHeight+'vw';
        wBar.style.marginTop = (dW > 0 ? 6.65 - wHeight : 6.65)+'vw';

        var dU = dQ + dW;
        var uHeight = limit(Math.abs(dU) / workScale)*6.65;
        uBar.style.height = uHeight+'vw';
        uBar.style.marginTop = (dU > 0 ? 6.65 - uHeight : 6.65)+'vw';

        document.getElementById("workNumber").innerHTML = (dU / 1000.0).toFixed(1) + " kJ";
    }
    updatedCurrentStates();

    var gasParticles = [];
    function editGasAmount() {
        var gasCount = Math.round(currentStates.n * 10);
        if (gasCount > gasParticles.length) {
            while (gasParticles.length < gasCount) { gasParticles.push([Math.random(), Math.random(), 2*Math.random()-1, 2*Math.random()-1]); }
        } else if (gasCount < gasParticles.length) {
            while (gasParticles.length > gasCount) { gasParticles.splice(Math.floor(Math.random()*gasParticles.length),1); }
        }
    }

    function gasLoop() {
        animateGas();
        drawGas();

//        if (pause) return;
        window.requestAnimationFrame(gasLoop);
    }

    var lastTime = new Date().getTime();
    function animateGas() {
        var now = new Date().getTime();
        var dt = (now - lastTime) / 1000; // seconds
        var m = currentStates.T / (30 * currentStates.V); // movement speed, depends on temperature and box volume
        if ( m > 10 ) { m = 10; } // cap movement speed at a reasonable amount
        for (var i = 0; i < gasParticles.length; i++) {
            var p = gasParticles[i]; // this particle

            var n = [p[0] + m*dt*p[2], p[1] + m*dt*p[3]];
            while (n[0] < 0 || n[0] > 1 ) {
                if (n[0] < 0) {
                    n[0] = -n[0]
                } else if (n[0] > 1) {
                    n[0] = 2 - n[0];
                }
                p[2] = -p[2];
            }
            while (n[1] < 0 || n[1] > 1 ) {
                if (n[1] < 0) {
                    n[1] = -n[1]
                } else if (n[1] > 1) {
                    n[1] = 2 - n[1];
                }
                p[3] = -p[3];
            }
            lastTime = now;

            gasParticles[i] = [limit(n[0]), limit(n[1]), p[2], p[3]] // set particle
        }
    }

    function drawGas() {
        var canvas = document.getElementById("particleBox");
        var ctx = canvas.getContext("2d");
        ctx.fillStyle = "#141414";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        var particleImage = document.getElementById("particleImg");
        var radius = 40 / currentStates.V; if (currentStates.V < 0.8) { radius = 50; }
        var w = canvas.width - 2*radius, h = canvas.height - 2*radius;
        for (var i = 0; i < gasParticles.length; i++) {
            var particle = gasParticles[i];
            ctx.drawImage(particleImage, particle[0] * w, particle[1] * h, radius*2, radius*2);
        }
    }

    editGasAmount();
    gasLoop();
</script>
</body>
</html>